# Product Requirements Document: Security Vulnerability Remediation

## 1. Introduction
This document outlines the requirements and plan to address 9 security vulnerabilities identified in the project's dependencies via `npm audit`. The vulnerabilities range from Low to High severity and affect core packages including `@modelcontextprotocol/sdk`, `glob`, `body-parser`, and `next-auth`.

## 2. Goals
*   **Zero Vulnerabilities:** Eliminate all 9 identified vulnerabilities.
*   **System Stability:** Ensure the application builds and tests pass after updates.
*   **Dependency Hygiene:** Resolve the `tmp` vulnerability in `stryker-cli` without compromising the mutation testing functionality.

## 3. Vulnerability Scope
The following packages require remediation:
1.  **@modelcontextprotocol/sdk** (High): DNS rebinding protection.
2.  **glob** (High): Command injection.
3.  **body-parser** (Moderate): Denial of service.
4.  **js-yaml** (Moderate): Prototype pollution.
5.  **next-auth** (Moderate): Email misdelivery.
6.  **tmp** (Low/Moderate): Arbitrary file write (affects `stryker-cli`).

## 4. Functional Requirements

### 4.1. Automated Remediation
*   The system must attempt standard automated fixes first.
*   **Command:** `npm audit fix` (without `--force` initially).

### 4.2. Specific Package Updates
*   **@modelcontextprotocol/sdk:** Update to version `>=1.24.0`.
*   **glob:** Update to a secure version (patched in `10.4.5` or similar).
*   **next-auth:** Update to version `>=4.24.12`.
*   **body-parser:** Update to version `>2.2.0`.

### 4.3. Complex Resolution (stryker-cli)
*   The `tmp` vulnerability is nested within `stryker-cli` -> `inquirer` -> `external-editor`.
*   **Requirement:** Instead of blindly running `npm audit fix --force` (which threatens to downgrade `stryker-cli` to `0.0.2`), the developer must:
    1.  Check if `stryker-cli` is a direct dependency.
    2.  Attempt to update `stryker-cli` to its *latest* stable version to see if recent versions use updated dependencies.
    3.  If no safe update exists, evaluate if `stryker-cli` is necessary or if it can be replaced by `@stryker-mutator/core`.
    4.  Apply `npm audit fix --force` only as a last resort if it does not break the `test` command.

## 5. Non-Goals
*   Major framework upgrades (e.g., migrating Next.js versions) unless strictly required for a security patch.
*   Refactoring code logic unrelated to the dependencies.

## 6. Success Metrics
*   `npm audit` returns: `found 0 vulnerabilities`.
*   `npm run build` completes successfully.
*   `npm run test` (or project equivalent) passes without regression.

## 7. Technical Considerations
*   **Breaking Changes:** `glob` v10 has some API changes compared to v7/v8. If the project uses `glob` directly in code/scripts, those usages must be verified.
*   **Testing:** Since `stryker-cli` is a testing tool, verify mutation testing (if active) still runs.

## 8. Open Questions
*   Is `stryker-cli` actively used, or is it a leftover dependency? (To be verified during implementation).
